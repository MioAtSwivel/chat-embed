var ChatWidget;(()=>{"use strict";var e={d:(t,a)=>{for(var o in a)e.o(a,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:a[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{createWidget:()=>r,stopNotification:()=>c});const a="BFimg4nhhiga2UkChbE_luhDsQoQL1_82igq9D9--RMSSVVOsCC1kd4Rc6V2vDcq7Bh0feKWxcvpZpY8eBr4Vhg";let o;async function i(e,t){const i=await async function(e,t){if("serviceWorker"in navigator){const a=await navigator.serviceWorker.register("/swivel-sw.js");return navigator.serviceWorker.ready.then((a=>{a.active.postMessage({token:e,system:t})})),a}console.log("[chat-embed] No service worker available")}(e,t);console.log(i),i&&await async function(e,t){const i=await e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:s(a)});o=i;const n={"content-type":"application/json",Authorization:`Bearer ${t}`};console.log(`chatembed: ${n}`);const r=await fetch("https://auth.swivelsoftware.asia/api/notification/subscribe",{method:"POST",body:JSON.stringify(i),headers:n});r.ok&&console.dir(r)}(i,e),console.log("[chat-embed] service worker registered")}function s(e){const t=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),a=window.atob(t),o=new Uint8Array(a.length);for(let e=0;e<a.length;++e)o[e]=a.charCodeAt(e);return o}async function n({token:e,system:t,entityType:a,entityKey:o,entityReferenceKey:i,overrideCss:s,widgetSrc:n,full:r,button:c,right:d}){try{!function(e){const t={uat:"https://chat-uat.swivelsoftware.asia/v2/widgets/swivel-chat-widget.js",dev:"https://chat-uat.swivelsoftware.asia/dev-v2/widgets/swivel-chat-widget.js",prod:"https://chat.swivelsoftware.asia/v2/widgets/swivel-chat-widget.js",local:"./dist/swivel-chat-widget.min.js"},a=document.getElementsByTagName("head")[0];let o=document.createElement("script");if(o.type="text/javascript",!t[e])throw new Error("Invalid source version of chat widget: "+e);o.src=t[e],a.appendChild(o)}(n)}catch(e){return void console.error(e)}if(a||(a="customer"),!o||!i){const t=await fetch("https://auth.swivelsoftware.asia/api/person/default",{method:"GET",headers:{"selected-partygroup":"","x-system":"360uat","Content-Type":"application/json",Authorization:`Bearer ${e}`}}),a=await t.json();o=a.selectedPartyGroup.code,i=a.selectedPartyGroup.name}const l=document.getElementById("chat-container"),u=document.createElement("swivel-chat-widget");u.setAttribute("id","swivel-chat-widget"),u.setAttribute("name",JSON.stringify(["Main"])),u.setAttribute("token",e),u.setAttribute("system",["360uat","360dev"].includes(t)?"360uat":t),u.setAttribute("uat","true"),u.setAttribute("propdata",JSON.stringify({full:r,button:c,right:d,system:["360uat","360dev"].includes(t)?"360uat":t,entityType:a,entityKey:o,entityReferenceKey:i,hasPublicChatroom:!0,extraChatrooms:[],maxShowChatroom:6,leftOffset:0,rightOffset:0})),u.setAttribute("injectCss",l.id);const h=document.createElement("style");h.innerHTML=s,l.appendChild(u),u.shadowRoot&&(console.log(h),u.shadowRoot.appendChild(h)),document.body.addEventListener("swivel-widget-loaded",(()=>{u.shadowRoot&&u.shadowRoot.appendChild(h)}))}async function r({token:e,username:t,password:a,system:o,entityType:s,entityKey:r,entityReferenceKey:c,overrideCss:d,expireTime:l,widgetSrc:u,full:h,button:y,right:p}){e||(e=await async function(e,t,a,o){const i=await fetch("https://auth.swivelsoftware.asia/auth/local/login",{method:"POST",headers:{"selected-partygroup":o||"","x-system":"360uat","Content-Type":"application/json"},body:JSON.stringify({username:e,password:t,rememberMe:!1,expiry:a})});return(await i.json()).accessToken}(t,a,l,r)),localStorage.setItem("360-accessToken",e),await n({token:e,system:o,entityType:s,entityKey:r,entityReferenceKey:c,overrideCss:d,widgetSrc:u,full:h,button:y,right:p}),await i(e,o)}async function c(){!async function(){const e={"content-type":"application/json",Authorization:`Bearer ${localStorage.getItem("360-accessToken")}`},t=await fetch("https://auth.swivelsoftware.asia/api/notification/unsubscribe",{method:"POST",body:JSON.stringify(o),headers:e});t.ok&&console.dir(t)}()}ChatWidget=t})();